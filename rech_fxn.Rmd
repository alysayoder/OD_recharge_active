---
title: "Recharge Function"
author: "Alysa M. Yoder"
date: "June 25, 2018"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    code_folding: hide
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, 
                      message = FALSE,
                      error = FALSE, 
                      cache = TRUE, 
                      eval = TRUE)
library(here)
```

## Notes
Supplementary material to the recharge volume calculator function.
Actual function is in rech_fxn.R, this 'rech_fxn.Rmd' has the formatting and its where I'll actually do the calculations of recharge. 

> Rules

* import water levels at the beginning and end of the event
* input files' columns must be in this order: lat, long, level
* the 'level' column must be in meters of groundwater elevation relative to mean sea level

***

# Get Groundwater Level Data
```{r}
adata <- read.csv(here('data', 'allsets.csv'), stringsAsFactors = FALSE)
adata <- adata[-c(1,3,15,17:31)] #removing index numbers, MW-13, Oneto-Ag (confined), and Nathan's text 
```

# Call Functions
```{r}
source('rech_fxn.R')
source('rechcalc_gwl_format.R')
```

# Get Lat Long Coordinates for Each Well, this also happens inside 'rechcalc_gwl_format.R' function
```{r, include= FALSE}
# format dataframes w/lat long 
label <- read.csv(here('data', "MW_label_allsets.csv"), header = F) #get lat long data, already in order of allsets.csv wells
label[3] <- NULL #removes well ID text column, leaving only lat long coords
```

# Get Data from Desired Dates
```{r, include=FALSE}
# grab max and mins from each water year. 
max2014 <- as.data.frame(t(subset(adata, Date == "2014-05-10 12:00:00")))
min2014 <- as.data.frame(t(subset(adata, Date == "2014-02-09 12:00:00")))

max2015 <- as.data.frame(t(subset(adata,Date =="2015-04-12 12:00:00")))
min2015 <- as.data.frame(t(subset(adata,Date =="2014-12-04 12:00:00")))

max2016 <- as.data.frame(t(subset(adata,Date =="2016-03-18 12:00:00")))
min2016 <- as.data.frame(t(subset(adata,Date=="2016-12-10 12:00:00")))
```

# Comparison of Similar Event Pre&Post Levee Removal
Why is it returning larger than actual changes in water level at MW23 and MW 17? 

* Subset was converting numeric water levels to factor, this is now fixed in the formatting function by converting this column back to numeric. 
```{r}
#recharge event max and min GWLs pre-removal, during the 2014 WY
evlo14 <- as.data.frame(t(subset(adata, Date == "2014-02-10 02:15:00")))
evhi14 <- as.data.frame(t(subset(adata, Date == "2014-02-12 05:30:00")))
#clean up data to get just water levels
#low
evlo14 <- rechcalc_gwl_format(evlo14)
#high
evhi14 <- rechcalc_gwl_format(evhi14)
#use function for 2014 event 
rechvol(begin = evlo14, end = evhi14, plot_title = "2014WY Event")

#repeat all for 2015 WY
evlo15 <- as.data.frame(t(subset(adata, Date == "2014-12-12 21:15:00")))
evhi15 <- as.data.frame(t(subset(adata, Date == "2014-12-14 09:30:00")))
#clean up data to get just water levels
#low
evlo15 <- rechcalc_gwl_format(evlo15)
#high
evhi15 <- rechcalc_gwl_format(evhi15)
#use function for 2014 event 
rechvol(begin = evlo15, end = evhi15, plot_title = "2015WY Event")

```

