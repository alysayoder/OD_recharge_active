---
title: "Recharge Event Determination"
author: "Alysa M. Yoder"
date: "March 8, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Plot average hydrograph w/plotly 
```{r}
library(magrittr)
library(plotly)
library(lubridate)
library(readr)
adata <- read.csv('allsets.csv')
adata <- adata[-c(1,3,17:31)]
adata
adata$mean <- rowMeans(x=adata[,2:14], na.rm=TRUE)
p2 <- plot_ly(adata, x=~Date, y=~mean, type = 'scatter', mode = 'lines') %>%
  rangeslider()
p2

# grab max and mins from each water year. Save as CSV files. 
max2014 <- subset(adata, Date == "2014-05-10 12:00:00")
min2014 <- subset(adata, Date == "2014-02-09 12:00:00")
```

## Plot 2017 Water Year Hydrograph w/plotly
```{r}
library(lubridate)
library(dplyr)
library(plotly)
df17 <- read.csv('allsets.csv') # read in entire groundwater level dataset 
df17$X <- NULL # remove unwanted column
df17$mean <- rowMeans(x=df17[,2:14], na.rm=TRUE) # take the mean of all water levels
df17$Date <- as.POSIXct(df17$Date, format = "%Y-%m-%d %H:%M:%S") # convert to appropriate date/time format
df17 <- df17 %>%
    filter(Date >= as.POSIXct("2016-10-01 00:00:00", tz="America/Los_Angeles") & 
             Date <= as.POSIXct("2017-09-30 00:00:00", tz = "America/Los_Angeles")) # filter to desired date range, WY2017

p <- plot_ly(df17, x= ~Date, y=~SWL.OA, type = 'scatter', name = 'Oneto-Ag', mode = 'lines') %>% # plot mean and data from all wells
    add_trace(y=~SWL.7, name = "MW-7", mode = 'lines') %>%
    add_trace(y=~SWL.19, name = "MW-19", mode = 'lines') %>%
    add_trace(y=~SWL.22, name = "MW-22", mode = 'lines') %>%
    add_trace(y=~SWL.23, name = "MW-23", mode = 'lines') %>%
    add_trace(y=~SWL.5, name = "MW-5", mode = 'lines') %>%
    add_trace(y=~SWL.3, name = "MW-3", mode = 'lines') %>%
    add_trace(y=~SWL.2, name = "MW-2", mode = 'lines') %>%
    add_trace(y=~SWL.9, name = "MW-9", mode = 'lines') %>%
    add_trace(y=~SWL.20, name = "MW-20", mode = 'lines') %>%
    add_trace(y=~SWL.11, name = "MW-11", mode = 'lines') %>%
    add_trace(y=~SWL.14, name = "MW-14", mode = 'lines') %>%
    add_trace(y=~SWL.13, name = "MW-13", mode = 'lines') %>%
    add_trace(y=~mean, name = "Mean", mode = 'lines', line = list(color="black")) %>%     # mean SWL
    rangeslider()
p
    
```
# Add inundation data from Alison
```{r}
library(lubridate)
library(plotly)
inundation_data <- read.csv("Whipple_Hydrospatial_PostRestoration_wy2013-2017.csv")
head(inundation_data)
inundation_data$dt <- mdy(inundation_data$dt)

ay <- list(
  tickfont = list(color= "red"),
  overlaying = "y", 
  side = "right", 
  title = "second axis"
)
p_inundation <- plot_ly(inundation_data, x= ~dt, y= ~volume_m3, type = "scatter") %>%
  add_trace(y=~percent_area, name="Percent Area Flooded", yaxis= 'y2') %>% # need to plot this on a secondary axis to compare. 
  layout(
    title = "Flooding at Oneto-Denier", yaxis2=ay,
    xaxis = list(title="x")
  ) %>%
  rangeslider()
p_inundation
```



