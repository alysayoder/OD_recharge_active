---
title: "Recharge Event Comparisons"
author: "Alysa M. Yoder"
date: "June 27, 2018"
output: 
 html_document:
    toc: TRUE
    toc_float: TRUE
    code_folding: hide
    theme: flatly
---

```{r setup, include=FALSE}
library(knitr)
library(here)
knitr::opts_chunk$set(warning = FALSE, 
                      message = FALSE,
                      error = FALSE, 
                      cache = TRUE, 
                      eval = TRUE)
```

## Writing a df for all recharge event timeframes in 2013WY
```{r}
event_pre13 <- data.frame(matrix(ncol = 4, nrow = 3))
cnames <- c("Event Number", "Start", "End", "Length")
colnames(event_pre13) <- cnames

#event_pre13$`Event Number` <- seq(1,3,1)
event_pre13$Start <- as.POSIXct(c("12/18/2012 22:00:00", "12/23/2012 02:45:00", "01/05/2013 21:45:00"), 
                                format = "%m/%d/%Y %H:%M")
event_pre13$End <- as.POSIXct(c("12/19/2012 20:00:00", "12/28/2012 14:00:00", "01/09/2013 02:00:00"), 
                                format = "%m/%d/%Y %H:%M")
#event_pre13$Length <- event_pre13$End - event_pre13$Start #leaving empty so they'll be consistent 
```

## Writing a df for all recharge event timeframes in 2014WY
```{r}
event_pre14 <- data.frame(matrix(ncol=4, nrow=4))
cnames <- c("Event Number", "Start", "End", "Length")
colnames(event_pre14) <- cnames
#event_pre14[ ,1] <- seq(1,4,1) #leaving blank, more efficient to do all at once after rbind
#these are start times of each event 
event_pre14[ ,2] <- as.POSIXct(c("02/09/2014 23:00:00", 
                                 "03/01/2014 02:00:00", 
                                 "03/02/2014 18:35:00", 
                                 "04/02/2014 15:45:00"),
                               format = "%m/%d/%Y %H:%M")
#these are end times of each event 
event_pre14[ ,3] <- as.POSIXct(c("02/12/2014 18:00:00", 
                                 "03/06/2014 15:30:00", 
                                 "03/08/2014 14:00:00", 
                                 "04/05/2014 16:00:00"),
                               format = "%m/%d/%Y %H:%M")
#event_pre14[ ,4] <- event_pre14[ ,3] - event_pre14[ ,2] #leaving these empty for now so units will be consistent
```

## Writing a df of all pre-removal recharge event timeframes
```{r}
event_pre <- rbind(event_pre13, event_pre14)
event_pre$`Event Number` <- seq(1,nrow(event_pre), 1)
event_pre$Length <- event_pre$End-event_pre$Start

```
***
## Get integrated discharge volume for each pre-removal event

### Get Data
```{r}
library(here)
library(dplyr)
library(kableExtra)
mb <- read.csv(here::here("data", "mich_bar_cms_all.csv"), stringsAsFactors = FALSE)
mb$Date <- as.POSIXct(mb$Date, format = "%m/%d/%Y %H:%M")
```

### Put Integrated Discharge Values into a df
```{r}
source("Qvol_fxn.R") #calculates cumulative discharge throughout a time period w/Mich.Bar data
source("evsub_fxn.R") #creates df with data from the specified time interval 

#add event ID column to DF for cleaner result communication
EventID <- seq(1,nrow(event_pre),1)

Qdat <- data.frame(EventID) # event number in event_pre corresponds to the row numbers in Qdat. 

for (row in 1:nrow(event_pre)) {
 Qdat[row, 2] <- Qvol(ev_data = evsub(event_pre[row,2], event_pre[row,3]))
}
colnames(Qdat) <- c("Event #", "Integrated Discharge m^3^")
 
```

### Results
```{r}
kable(Qdat, caption = "Integrated Flow Volume at Michigan Bar during Pre-Levee Removal Recharge Events (m^3^)") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

```

## Estimate Recharge for each pre-removal event
```{r}
source("rech_fxn.R")
source("rechcalc_gwl_format.R")
rechout <- data.frame(EventID)
dat <- 
for (ev in 1:nrow(event_pre)) {
  dat[[ev]][1] <- as.data.frame(t(subset(adata, Date == as.character(event_pre$Start[ev]))))
  dat[[ev]][2] <- as.data.frame(t(subset(adata, Date == as.character(event_pre$End[ev]))))
}

 #rechvol(begin = dat[[ev]][1], end = dat[[ev]][2], plot_title = "Pre-Removal Recharge Events"


```
